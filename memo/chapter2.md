# Chapter2. 현실에서의 함수형 사고

# 액션과 계산, 데이터
- 계층형 설계


# 일급 추상
- 일급 함수(first-class function)
- 타임라인 다이어그램

# 계층형 설계(stratified design) 원칙
- 3가지 계층
  1. 비즈니스 규칙
  2. 도메인 규칙
  3. 기술 스택
```
비즈니스 규칙 -> 도메인 규칙 -> 기술 스택
```
> `->` 는 의존성을 나타냄

# 예시) 토니 피자
```
<< 액션 >>
반죽 펴기
피자 배달
재료 주문

<< 계산 >>
조리법에 나온 것을 두 배로 만들기
쇼핑 목록 결정

<< 데이터 >>
고객 주문
영수증
조리법
```
```
<< 타임라인 다이어그램 >>
치즈 피자 만들기

<< 순차적인 프로그램 >>
주문 접수
반죽 만들기
반죽 펴기
소스 만들기
소스 뿌리기
치즈 갈기
오븐에 넣기
10분 기다리기
서빙

<< 분산 시스템 >> 로봇 3대
로봇 1    | 로봇 2       | 로봇 3
주문 접수  | 반죽만들기     | 반죽펴기
소스 만들기 | 소스 뿌리기   | 치즈 갈기
오븐에 넣기 | 10분 기다리기 | 서빙
```

## 타임라인 다이어그램
- 시간에 따라 변하는 액션을 시각화하는 방법
- 타임라인에 있는 모든 단계는 액션입니다
- 분산 시스템에서는 각 치즈 피자를 만드는 로봇은 각자의 타임라인을 가지고 동시에 일을 합니다
- 각각의 타임라인에서 처리되는 일은 순서가 섞여 누가 먼저 끝날지 알 수 없습니다
- 타임라인을 서로 맞추지 않은 분산 시스템은 예측 불가능한 순서로 실행됩니다
- 타임라인은 동시에 실행되는 분산 시스템을 시각화하기에 좋다

# 순차적인 프로그램을 분산 시스템으로 바꾸었을 때의 문제점
1. 기본적으로 타임라인은 서로 순서를 맞추지 않습니다
2. 액션이 실행되는 시간은 중요하지 않습니다
3. 드물지만 타이밍이 어긋나는 경우는 실제 일어납니다
4. 타임라인 다이어그램으로 시스템의 문제를 알 수 있습니다

# 타임라인 커팅
- 타임라인의 시간을 맞추는 작업
- 타임라인 커팅은 고차 동작으로 구현
- 타임라인 커팅은 서로 다른 작업들을 쉽게 이해할 수 있다
- 액션 간 협력을 위해 사용